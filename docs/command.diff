diff --git a/command.c b/command.v3.c
index 2412d12..18504a7 100644
--- a/command.c
+++ b/command.v3.c
@@ -29,6 +29,7 @@
 #include <glib/gi18n.h>
 #include <gio/gio.h>
 #include <gtk/gtk.h>
+#include <gdk-pixbuf/gdk-pixbuf.h>
 
 #include <mate-panel-applet.h>
 #include <mate-panel-applet-gsettings.h>
@@ -42,6 +43,8 @@
 #define COMMAND_SCHEMA "org.mate.panel.applet.command"
 #define COMMAND_KEY    "command"
 #define INTERVAL_KEY   "interval"
+#define ICON_SIZE_KEY  "icon-size"    
+#define ICON_NAME_KEY  "icon"
 #define SHOW_ICON_KEY  "show-icon"
 #define WIDTH_KEY      "width"
 
@@ -62,11 +65,15 @@ typedef struct
     GtkLabel          *label;
     GtkImage          *image;
     GtkBox            *box;
+    GdkPixbuf         *buf;
     MaCommand         *command;
     GCancellable      *cancellable;
+    GtkWidget         *icon_chooser;
     gboolean           running;
 
     gchar             *cmdline;
+    gchar             *filename;
+    gint               size;
     gint               interval;
     gint               width;
 
@@ -79,8 +86,13 @@ static gboolean command_execute (CommandApplet *command_applet);
 static gboolean command_text_changed (GtkWidget *widget, GdkEvent  *event, gpointer user_data);
 static void interval_value_changed (GtkSpinButton *spin_button, gpointer user_data);
 static void width_value_changed (GtkSpinButton *spin_button, gpointer user_data);
+static void icon_size_changed (GtkSpinButton *spin_button, gpointer user_data);
+static void icon_name_changed (GtkFileChooser *chooser, CommandApplet *command_applet);
 static void command_async_ready_callback (GObject *source_object, GAsyncResult *res, gpointer user_data);
 static gboolean timeout_callback (CommandApplet *command_applet);
+static gboolean load_icon_image(CommandApplet *command_applet);
+static char* get_default_icon (CommandApplet *command_applet);
+static char* get_icon_path(CommandApplet *command_applet);
 
 static const GtkActionEntry applet_menu_actions [] = {
     { "Preferences", "document-properties", N_("_Preferences"), NULL, NULL, G_CALLBACK (command_settings_callback) },
@@ -111,10 +123,64 @@ command_applet_destroy (MatePanelApplet *applet_widget, CommandApplet *command_a
     {
         g_object_unref (command_applet->command);
     }
-
+ 
     g_object_unref (command_applet->settings);
 }
 
+static char* get_default_icon (CommandApplet *command_applet)
+{
+    gchar *default_icon;
+    
+    const gchar *icon_file = gtk_icon_info_get_filename (gtk_icon_theme_lookup_icon (gtk_icon_theme_get_default(), /* get icon theme */
+                                                                                         APPLET_ICON, /* choose icon name */
+                                                                                         command_applet->size, /* icon size */
+                                                                                         0)); /* icon flag */
+    default_icon = g_strdup (icon_file);
+    return default_icon;
+}
+
+static char* get_icon_path(CommandApplet *command_applet)     
+{     
+   gchar *path;     
+    
+    if (g_path_is_absolute (command_applet->filename))     
+        path = g_strdup (command_applet->filename);     
+    else 
+        path = get_default_icon (command_applet);
+
+    return path;     
+}     
+
+static gboolean load_icon_image(CommandApplet *command_applet)
+{
+    GdkPixbuf *buf;
+    GError    *error = NULL;
+    char      *path;                                      
+                                                                                      
+    path = get_icon_path (command_applet);             
+                                        
+    if (!command_applet->filename)                                            
+        command_applet->filename = path; 
+                                                    
+    buf = gdk_pixbuf_new_from_file_at_size (path, command_applet->size, command_applet->size, &error);   
+    if (error) {                                       
+        g_warning ("Cannot load '%s': %s", path, error->message);                      
+        g_error_free (error);                             
+        g_free (path);               
+        return FALSE;                                                 
+    }                              
+                                                  
+    if (command_applet->buf)     
+        g_object_unref (command_applet->buf);
+    command_applet->buf = buf;
+
+    gtk_image_set_from_pixbuf(GTK_IMAGE(command_applet->image), command_applet->buf);
+                     
+    g_free (path);                                                 
+                                     
+    return TRUE;
+}
+
 /* Show the about dialog */
 static void
 command_about_callback (GtkAction *action, CommandApplet *command_applet)
@@ -154,6 +220,51 @@ command_text_changed (GtkWidget *widget, GdkEvent  *event, gpointer user_data)
     return TRUE;
 }
 
+static void icon_name_changed (GtkFileChooser *chooser, CommandApplet *command_applet)
+{
+
+    gchar *path;
+    gchar *filename;
+    gchar *path_gsettings;
+
+    path = gtk_file_chooser_get_filename (GTK_FILE_CHOOSER(chooser));
+    
+    if (!path || !path[0]) {
+        g_free (path);
+        return;
+    }
+
+    path_gsettings = get_icon_path (command_applet);
+
+    if (!strcmp (path, path_gsettings)) {
+        g_free (path);
+        g_free (path_gsettings);
+        return;
+    }
+    g_free (path_gsettings);
+
+    filename = path;
+
+    g_settings_set_string (command_applet->settings, ICON_NAME_KEY, filename);
+
+    g_free (path);
+}
+
+static void icon_size_changed (GtkSpinButton *spin_button, gpointer user_data)
+{
+    gint value;
+    CommandApplet *command_applet;
+
+    command_applet = (CommandApplet*) user_data;
+    value = gtk_spin_button_get_value_as_int (spin_button);
+    if (command_applet->size == value) {
+        return;
+    }
+
+    g_settings_set_int (command_applet->settings, ICON_SIZE_KEY, value);
+
+}
+
 static void interval_value_changed (GtkSpinButton *spin_button, gpointer user_data)
 {
     gint value;
@@ -188,14 +299,22 @@ command_settings_callback (GtkAction *action, CommandApplet *command_applet)
 {
     GtkDialog *dialog;
     GtkBuilder *builder;
+    gchar *path;
 
     builder = gtk_builder_new_from_resource ("/org/mate/mate-applets/command/command-preferences.ui");
+    command_applet->icon_chooser = GTK_WIDGET (gtk_builder_get_object (builder, "icon_entry"));
+
+    path = get_icon_path (command_applet);
+    gtk_file_chooser_set_filename (GTK_FILE_CHOOSER (command_applet->icon_chooser), path);
+    g_free (path);
+
 
     dialog = GET_DIALOG ("preferences_dialog");
 
     g_settings_bind (command_applet->settings, COMMAND_KEY, GET_WIDGET ("command_entry"), "text", G_SETTINGS_BIND_GET_NO_CHANGES);
     g_settings_bind (command_applet->settings, INTERVAL_KEY, GET_WIDGET ("interval_spinbutton"), "value", G_SETTINGS_BIND_GET_NO_CHANGES);
     g_settings_bind (command_applet->settings, WIDTH_KEY, GET_WIDGET ("width_spinbutton"), "value", G_SETTINGS_BIND_GET_NO_CHANGES);
+    g_settings_bind (command_applet->settings, ICON_SIZE_KEY, GET_WIDGET ("icon_spinbutton"), "value", G_SETTINGS_BIND_GET_NO_CHANGES);
     g_settings_bind (command_applet->settings, SHOW_ICON_KEY, GET_WIDGET ("show_icon_check"), "active", G_SETTINGS_BIND_DEFAULT);
 
     /* signals */
@@ -203,7 +322,10 @@ command_settings_callback (GtkAction *action, CommandApplet *command_applet)
                                       "on_command_entry_focus_out_event", G_CALLBACK (command_text_changed),
                                       "on_interval_spinbutton_value_changed", G_CALLBACK (interval_value_changed),
                                       "on_width_spinbutton_value_changed", G_CALLBACK (width_value_changed),
+                                      "on_icon_spinbutton_value_changed", G_CALLBACK (icon_size_changed),
+                                      "on_icon_entry_selection_changed", G_CALLBACK (icon_name_changed),
                                       NULL);
+
     gtk_builder_connect_signals (builder, command_applet);
 
     g_signal_connect (dialog, "response",
@@ -211,7 +333,7 @@ command_settings_callback (GtkAction *action, CommandApplet *command_applet)
                       dialog);
 
     g_object_unref (builder);
-
+    
     gtk_widget_show_all (GTK_WIDGET (dialog));
 }
 
@@ -242,6 +364,59 @@ settings_command_changed (GSettings *settings, gchar *key, CommandApplet *comman
     command_execute (command_applet);
 }
 
+static void
+settings_icon_changed (GSettings *settings, gchar *key, CommandApplet *command_applet)
+{
+    gchar *name;
+
+    name = g_settings_get_string (command_applet->settings, ICON_NAME_KEY);
+
+    if (!name || *name == '\0' || (command_applet->filename && !strcmp (command_applet->filename, name))) {
+        g_free(name);
+        return;
+    }
+
+    if (command_applet->filename)
+        g_free (command_applet->filename);
+    command_applet->filename = g_strdup (name);
+    
+    load_icon_image (command_applet);
+
+    if (command_applet->icon_chooser) {
+        gchar *path_gsettings;
+        gchar *path_chooser;
+
+        path_gsettings = get_icon_path (command_applet);
+        path_chooser = gtk_file_chooser_get_filename (GTK_FILE_CHOOSER (command_applet->icon_chooser));
+        if (strcmp (path_gsettings, path_chooser))
+            gtk_file_chooser_set_filename (GTK_FILE_CHOOSER (command_applet->icon_chooser), path_gsettings);
+
+        g_free (path_gsettings);
+        g_free (path_chooser);
+    }
+    if (name)
+        g_free (name);
+}
+
+static void
+settings_size_changed (GSettings *settings, gchar *key, CommandApplet *command_applet)
+{
+    gint size;
+
+    size = g_settings_get_int (command_applet->settings, ICON_SIZE_KEY);
+
+    /* make 40 interval display 48px */
+    if (size >= 40)
+        size = 48;
+
+    if (command_applet->size == size) {
+        return;
+    }
+    command_applet->size = size;
+
+    load_icon_image (command_applet);
+}
+
 static void
 settings_width_changed (GSettings *settings, gchar *key, CommandApplet *command_applet)
 {
@@ -300,7 +475,7 @@ process_command_output (CommandApplet *command_applet, gchar *output)
             }
 
             if (icon)
-                gtk_image_set_from_icon_name (command_applet->image, icon, GTK_ICON_SIZE_LARGE_TOOLBAR);
+                gtk_image_set_from_pixbuf (GTK_IMAGE (command_applet->image), command_applet->buf);
 
             g_free (goutput);
             g_free (icon);
@@ -417,21 +592,24 @@ command_applet_fill (MatePanelApplet* applet)
     command_applet->applet = applet;
     command_applet->settings = mate_panel_applet_settings_new (applet, COMMAND_SCHEMA);
 
+    command_applet->filename = g_settings_get_string (command_applet->settings, ICON_NAME_KEY);
     command_applet->interval = g_settings_get_int (command_applet->settings, INTERVAL_KEY);
     command_applet->cmdline = g_settings_get_string (command_applet->settings, COMMAND_KEY);
     command_applet->width = g_settings_get_int (command_applet->settings, WIDTH_KEY);
+    command_applet->size = g_settings_get_int (command_applet->settings, ICON_SIZE_KEY);
     command_applet->command = ma_command_new(command_applet->cmdline, NULL);
     command_applet->cancellable = g_cancellable_new ();
-
+    
+    command_applet->buf = gdk_pixbuf_new_from_file_at_size (command_applet->filename, command_applet->size, command_applet->size, NULL);
     command_applet->box = GTK_BOX (gtk_box_new (GTK_ORIENTATION_HORIZONTAL, 0));
-    command_applet->image = GTK_IMAGE (gtk_image_new_from_icon_name (APPLET_ICON, GTK_ICON_SIZE_LARGE_TOOLBAR));
+    command_applet->image = GTK_IMAGE (gtk_image_new_from_pixbuf (command_applet->buf));
     command_applet->label = GTK_LABEL (gtk_label_new (ERROR_OUTPUT));
     command_applet->timeout_id = 0;
 
     /* we add the Gtk label into the applet */
     gtk_box_pack_start (command_applet->box,
                         GTK_WIDGET (command_applet->image),
-                        TRUE, TRUE, 0);
+                        TRUE, TRUE, 8);
     gtk_box_pack_start (command_applet->box,
                         GTK_WIDGET (command_applet->label),
                         TRUE, TRUE, 0);
@@ -458,6 +636,14 @@ command_applet_fill (MatePanelApplet* applet)
                       G_CALLBACK (settings_width_changed),
                       command_applet);
 
+    g_signal_connect (command_applet->settings, "changed::" ICON_SIZE_KEY,
+                      G_CALLBACK (settings_size_changed),
+                      command_applet);
+
+    g_signal_connect (command_applet->settings, "changed::" ICON_NAME_KEY,
+                      G_CALLBACK (settings_icon_changed),
+                      command_applet);
+
     g_settings_bind (command_applet->settings,
                      SHOW_ICON_KEY,
                      command_applet->image,
@@ -471,6 +657,8 @@ command_applet_fill (MatePanelApplet* applet)
                                   G_N_ELEMENTS (applet_menu_actions), command_applet);
     mate_panel_applet_setup_menu (command_applet->applet, ui, action_group);
 
+    /* first icon execution */
+    load_icon_image (command_applet);
     /* first command execution */
     command_execute (command_applet);
     return TRUE;
